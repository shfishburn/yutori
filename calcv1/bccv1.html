<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Responsive viewport and description -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <meta name="description" content="Yutori Labs - Body Composition Calculator V1" />
    <title>Body Composition Calculator V1</title>
    <!-- Include Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Tailwind CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="calc-styles.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Inline CSS for Modals and Buttons -->
    <style>
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-content {
        background: #fff;
        padding: 1.5rem;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .close-modal-btn {
        background: #007BFF;
        color: #fff;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn {
        background: #007BFF;
        color: #fff;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <nav class="nav-wrapper">
      <div class="container">
        <!-- Update asset path if necessary -->
        <a href="../index.html">
          <img src="/logo_400px_wide.png" alt="Yutori Labs" class="logo" />
        </a>
      </div>
    </nav>
    
    <section id="calculator" class="projects-section">
      <div class="container">
        <h1 class="text-3xl font-bold mb-4">Body Composition Calculator</h1>
        <p class="mb-6">This calculator determines your body composition goals based on the data you provide.</p>
    
        <!-- STEP 1: Your Information (Merged Inputs) -->
        <div class="wizard-step" id="step1" style="display: block;">
          <h2 class="text-xl font-semibold mb-2">Step 1: Your Information</h2>
          <div class="mb-4">
            <label class="block">Select Units (pounds or kilograms):</label>
            <div class="radio-group">
              <label><input type="radio" name="unit" value="lbs" id="radioLbs" checked /> lbs/inches</label>
              <label><input type="radio" name="unit" value="kg" id="radioKg" /> kg/cm</label>
            </div>
          </div>
          <div class="mb-4">
            <label>Height (in inches or cm):</label>
            <input type="number" id="heightInput" class="mb-2" placeholder="e.g., 70 in or 178 cm" />
          </div>
          <div class="mb-4">
            <label>AGE (18 to 75):</label>
            <input type="number" id="ageInput" min="20" max="69" class="mb-2" placeholder="e.g., 18 to 75" />
          </div>
          <div class="mb-4">
            <label>Gender (assigned at birth):</label>
            <div class="radio-group">
              <label><input type="radio" name="gender" value="female" id="radioFemale" checked /> Female</label>
              <label><input type="radio" name="gender" value="male" id="radioMale" /> Male</label>
            </div>
          </div>
          <div class="mb-4">
            <label>Total Weight:</label>
            <input type="number" id="totalWeightInput" class="mb-2" placeholder="e.g., pounds or kilograms" />
          </div>
          <div class="mb-4">
            <label>Body Fat (%):</label>
            <input type="number" id="bodyFatPctInput" step="0.1" class="mb-2" placeholder="e.g., 25 for 25% body fat" />
          </div>
          <div class="wizard-buttons">
            <button type="button" class="btn" data-next-step>Next</button>
          </div>
        </div>
    
        <!-- STEP 2: Goals & Activity -->
        <div class="wizard-step" id="step2">
          <h2 class="text-xl font-semibold mb-2">Step 2: Goals & Activity</h2>
          <!-- Weight goal is fixed to "Lose Weight" -->
          <p><strong>Weight Goal:</strong> Lose Weight</p>
          <p><a href="#" data-open-modal="dietaryApproachModal" class="text-blue-500 underline">Dietary Approach Info</a></p>
          <div class="radio-group mb-4">
            <label><input type="radio" name="dietaryApproach" value="low-carb" id="lowCarb" /> Low-Carb</label>
            <label><input type="radio" name="dietaryApproach" value="high-protein" id="highProtein" /> High-Protein</label>
            <label><input type="radio" name="dietaryApproach" value="balanced" id="balancedMacros" checked /> Balanced</label>
          </div>
          <p><a href="#" data-open-modal="activityLevelModal" class="text-blue-500 underline">Activity Info</a></p>
          <select id="activityLevelSelect" class="mb-4">
            <option value="1.2">Sedentary (1.2)</option>
            <option value="1.375">Light (1.375)</option>
            <option value="1.55" selected>Moderate (1.55)</option>
            <option value="1.725">Very Active (1.725)</option>
            <option value="1.9">Extremely Active (1.9)</option>
          </select>
          <p><a href="#" data-open-modal="calorieDeficitModal" class="text-blue-500 underline">Calorie Deficit Info</a></p>
          <!-- Calorie Deficit is a drop‑down -->
          <select id="dailyAdjustmentSelect" class="mb-4">
            <option value="-250" selected>Slow loss: (~250 cal/day deficit) ≈ 0.5 lb/week</option>
            <option value="-500">Moderate loss: (~500 cal/day deficit) ≈ 1 lb/week</option>
            <option value="-750">Rapid loss: (~750 cal/day deficit) ≈ 1.5 lb/week</option>
            <option value="-1000">Dangerous loss: (~1,000+ cal/day deficit) ≈ 2 lb/week or more</option>
          </select>
          <p><a href="#" data-open-modal="fatRangeModal" class="text-blue-500 underline">Fat% Range Info</a></p>
          <select id="fatGoalCategorySelect" class="mb-4">
            <option value="dangerouslyLow">Dangerously Low</option>
            <option value="excellent" selected>Excellent</option>
            <option value="good">Good</option>
            <option value="fair">Fair</option>
            <option value="poor">Poor</option>
            <option value="dangerouslyHigh">Dangerously High</option>
          </select>
          <div class="wizard-buttons">
            <button type="button" class="btn" data-prev-step>Back</button>
            <button type="button" class="btn" id="calculateButton">Calculate</button>
          </div>
        </div>
    
        <!-- STEP 3: Results -->
        <div class="wizard-step" id="step3">
          <div class="max-w-4xl mx-auto p-4">
            <!-- 2×2 Grid: Current & Goal Body Composition -->
            <h2 class="text-2xl font-bold mb-2">Current Body Composition</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Settings Card (Left) -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Settings</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Current Stats</h4>
                <ul class="space-y-1 text-sm">
                  <li><strong>Goal:</strong> <span id="summaryWeightGoal">Lose Weight</span></li>
                  <li><strong>Age:</strong> <span id="summaryAge">--</span></li>
                  <li><strong>Gender:</strong> <span id="summaryGender">--</span></li>
                  <li><strong>Dietary Approach:</strong> <span id="summaryDietApproach">--</span></li>
                  <li><strong>Activity:</strong> <span id="summaryActivityLevel">--</span></li>
                  <li><strong>Daily Calorie Deficit:</strong> <span id="summaryDailyAdj">--</span></li>
                  <li><strong>Lean Goal:</strong> <span id="summaryLeanGoalPct">--</span></li>
                </ul>
              </div>
              <!-- Current Composition Card (Right) -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Current Stats</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Body Composition</h4>
                <ul class="space-y-1 text-sm">
                  <li><strong>Weight:</strong> <span id="currentWeightSpan">--</span></li>
                  <li><strong>Fat Mass:</strong> <span id="currentFatSpan">--</span></li>
                  <li><strong>Lean Mass:</strong> <span id="currentLeanSpan">--</span></li>
                  <li><strong>BF%:</strong> <span id="currentBFpctSpan">--</span></li>
                  <li><strong>Category:</strong> <span id="currentBFcatSpan">--</span></li>
                </ul>
                <p class="mt-2 text-sm">
                  <a href="#" data-open-modal="bodyCompModal" class="text-blue-500 underline">Learn More about Your Body Composition</a>
                </p>
              </div>
            </div>
    
            <h2 class="text-2xl font-bold mt-8 mb-2">Goal Body Composition</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Goal Card (Left) -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Goal</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Target Range</h4>
                <ul class="space-y-1 text-sm">
                  <li><strong>Weight:</strong> <span id="goalWeightSpan">--</span></li>
                  <li><strong>Fat Mass:</strong> <span id="goalFatSpan">--</span></li>
                  <li><strong>Lean Mass:</strong> <span id="goalLeanSpan">--</span></li>
                  <li><strong>BF%:</strong> <span id="goalBFpctSpan">--</span></li>
                  <li><strong>Category:</strong> <span id="goalBFcatSpan">--</span></li>
                </ul>
                <p class="mt-2 text-sm">
                  <a href="#" data-open-modal="goalRangeModal" class="text-blue-500 underline">Learn More about Your Goal Range</a>
                </p>
              </div>
              <!-- Nutrition Card (Right) -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Nutrition</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Calories & Macros</h4>
                <ul class="space-y-1 text-sm">
                  <li><strong>BMR:</strong> <span id="bmrSpan">--</span></li>
                  <li><strong>TDEE:</strong> <span id="tdeeSpan">--</span></li>
                  <li><strong>Final Cals:</strong> <span id="finalCalsSpan">--</span> (<span id="deficitOrSurplusLine">--</span>)</li>
                  <li><strong>Carbs:</strong> <span id="carbsSpan">--</span></li>
                  <li><strong>Protein:</strong> <span id="proteinSpan">--</span></li>
                  <li><strong>Fat:</strong> <span id="fatSpan">--</span></li>
                  <li id="macroHealthComment" class="italic">--</li>
                </ul>
                <p class="mt-2 text-sm">
                  <a href="#" data-open-modal="calorieMacroModal" class="text-blue-500 underline">Learn More about Your Calorie & Macro Ranges</a>
                </p>
              </div>
            </div>
    
            <!-- Charts: Stacked Vertically -->
            <h2 class="text-2xl font-bold mt-8 mb-2">Charts</h2>
            <div class="grid grid-cols-1 gap-6">
              <!-- Weight Loss Trajectory Chart -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Weight Loss Trajectory</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Projected Weight Over Time</h4>
                <canvas id="weightChart" class="w-full h-64"></canvas>
              </div>
              <!-- Calorie Forecast Chart -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Calorie Forecast</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Daily Calorie Target</h4>
                <canvas id="calorieChart" class="w-full h-64"></canvas>
              </div>
              <!-- Macro Trajectory Chart -->
              <div class="bg-white shadow rounded p-4">
                <h3 class="text-xl font-semibold mb-1">Macro Trajectory</h3>
                <h4 class="text-sm font-medium text-gray-600 mb-2">Protein, Carbs & Fat (g)</h4>
                <canvas id="macroChart" class="w-full h-64"></canvas>
              </div>
              <p class="mt-2 text-sm">
                <a href="#" data-open-modal="forecastModal" class="text-blue-500 underline">Learn More about Forecast Charts</a>
              </p>
            </div>
    
            <!-- Bottom Buttons -->
            <div class="mt-6 text-center">
              <button class="btn px-4 py-2 bg-gray-700 text-white mr-2" id="newScenarioBtn">New Scenario</button>
              <button class="btn px-4 py-2 bg-gray-500 text-white" id="disclaimerLink">Disclaimer</button>
            </div>
          </div>
        </div>
    
      </div>
    </section>
    
    <!-- Modals -->
    <!-- Body Composition Modal -->
    <div class="modal-overlay" id="bodyCompModal">
      <div class="modal-content">
        <h3>Body Composition Details</h3>
        <p>This section shows your current body composition—including your weight, fat mass, lean mass, and BF%—which is used to set realistic goals.</p>
        <button class="close-modal-btn" data-close-modal="bodyCompModal">Close</button>
      </div>
    </div>
    
    <!-- Forecast Charts Modal -->
    <div class="modal-overlay" id="forecastModal">
      <div class="modal-content">
        <h3>Forecast Charts Explanation</h3>
        <p>The charts display your predicted weight loss trajectory, daily calorie target, and macronutrient needs over time. They update dynamically as your metabolic adaptation is simulated.</p>
        <button class="close-modal-btn" data-close-modal="forecastModal">Close</button>
      </div>
    </div>
    
    <!-- Explanation Modal for Settings -->
    <div class="modal-overlay" id="explanationModal">
      <div class="modal-content">
        <h3>How Are These Figures Calculated?</h3>
        <p>
          <strong>Settings:</strong> Your total weight, height, age, and gender are used with the Mifflin–St Jeor equation to compute your Resting Metabolic Rate (RMR):
          <br /><em>For males: (10 × weight_kg) + (6.25 × height_cm) – (5 × age) + 5</em>
          <br /><em>For females: (10 × weight_kg) + (6.25 × height_cm) – (5 × age) – 161</em>
          <br />TDEE is derived by multiplying RMR by your activity multiplier. Your goal weight range is calculated using your target BF percentages.
        </p>
        <button class="close-modal-btn" data-close-modal="explanationModal">Close</button>
      </div>
    </div>
    
    <!-- Explanation Modal for Goal Range -->
    <div class="modal-overlay" id="goalRangeModal">
      <div class="modal-content">
        <h3>Goal Range Explanation</h3>
        <p>
          Your goal weight range is determined by your lean mass (calculated as total weight × [1 – BF%]) and your target BF percentages:
          <br /><em>Goal Weight Low = Lean Mass ÷ (1 – pLow)</em> and <em>Goal Weight High = Lean Mass ÷ (1 – pHigh)</em>.
          For example, a reference user might have:
          <br />Weight: 218.35 lbs–232.00 lbs, Fat Mass: 32.75 lbs–46.40 lbs, Lean Mass: 185.60 lbs, BF%: 15.0%–20.0% (GOOD).
        </p>
        <button class="close-modal-btn" data-close-modal="goalRangeModal">Close</button>
      </div>
    </div>
    
    <!-- Explanation Modal for Calories & Macros -->
    <div class="modal-overlay" id="calorieMacroModal">
      <div class="modal-content">
        <h3>Calories & Macronutrients Explanation</h3>
        <p>
          Your RMR is computed using the Mifflin–St Jeor equation:
          <br /><em>For males: (10 × weight_kg) + (6.25 × height_cm) – (5 × age) + 5</em>
          <br /><em>For females: (10 × weight_kg) + (6.25 × height_cm) – (5 × age) – 161</em>
          <br />TDEE is derived by multiplying RMR by your activity multiplier.
          A relative deficit (selected from the drop‑down) is applied to set your daily calorie target.
          We then use a dynamic effective energy density:
          <em>E_eff = L × 760 + (1 – L) × 3500</em>,
          where L is the fraction of weight loss that is lean tissue, to simulate weight loss and update your macronutrient targets.
        </p>
        <button class="close-modal-btn" data-close-modal="calorieMacroModal">Close</button>
      </div>
    </div>
    
    <!-- Other Modals -->
    <div class="modal-overlay" id="weightGoalModal">
      <div class="modal-content">
        <h3>Weight Goal</h3>
        <p>This calculator supports a weight loss scenario only.</p>
        <button class="close-modal-btn" data-close-modal="weightGoalModal">Exit</button>
      </div>
    </div>
    
    <div class="modal-overlay" id="dietaryApproachModal">
      <div class="modal-content">
        <h3>Dietary Approach</h3>
        <p>Low‑carb, High‑protein, or Balanced macros determine your nutrient split.</p>
        <button class="close-modal-btn" data-close-modal="dietaryApproachModal">Exit</button>
      </div>
    </div>
    
    <div class="modal-overlay" id="activityLevelModal">
      <div class="modal-content">
        <h3>Activity Level</h3>
        <p>Your activity multiplier adjusts your RMR. Examples: Sedentary ~1.2, Very Active ~1.725.</p>
        <button class="close-modal-btn" data-close-modal="activityLevelModal">Exit</button>
      </div>
    </div>
    
    <div class="modal-overlay" id="calorieDeficitModal">
      <div class="modal-content">
        <h3>Calorie Deficit Info</h3>
        <p>
          The calorie deficit drop‑down provides options for a 250, 500, 750, or 1000 cal/day deficit.
          This deficit is applied relative to your TDEE to determine your daily calorie target.
        </p>
        <button class="close-modal-btn" data-close-modal="calorieDeficitModal">Exit</button>
      </div>
    </div>
    
    <div class="modal-overlay" id="fatRangeModal">
      <div class="modal-content">
        <h3>Fat% Range</h3>
        <p>Select a target body‑fat range (for example, "excellent" ~10–15% BF).</p>
        <button class="close-modal-btn" data-close-modal="fatRangeModal">Exit</button>
      </div>
    </div>
    
    <div class="modal-overlay" id="disclaimerModal">
      <div class="modal-content">
        <h3>Disclaimer</h3>
        <p>This is not medical advice. These estimates are based on current research; individual results may vary.
           Consult a healthcare professional for personalized guidance.
        </p>
        <button class="close-modal-btn" data-close-modal="disclaimerModal">Exit</button>
      </div>
    </div>
    
    <script src="calculator.js"></script>

    <footer class="footer-section">
      <div class="container">
        <div class="footer-content">
          <p class="text-white">&copy; 2025 Yutori Labs. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
